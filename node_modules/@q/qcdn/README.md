# 360静床/图床上传工具

在您Node.js项目中,方便的将文件上传至静床/图床

## 系统要求

- Linux/Mac/Windows(Windows不支持KeepName)
- Node 0.10+

## 安装
*需要首先安装qnpm，安装方法可[参考此教程](http://qnpm.qiwoo.org/help/download)*

### 安装到项目
```
qnpm install @q/qcdn
```

### 安装到全局
```
qnpm install -g @q/qcdn
```

## 使用命令行
*使用命令行需要将qcdn模块安装到全局*
```
qcdn [options] 文件/文件夹路径 [文件/文件夹路径...]

帮助:

  -h, --help      显示帮助
  -v, --version   显示版本号

上传文件:

  -s, --https     使用https链接
  -a, --all       上传全部文件,包含隐藏文件
  -f, --force     出错时不终止任务
  -k, --keep      链接中包含原始文件名
  -d, --directory 相对于该目录展示文件路径
  
上传文本:

  -c, --content     文本内容
  -t, --type <type> 文本类型

压缩:

  -m, --min       压缩文件
```

### 示例

上传文件`a.png`
```
  qcdn a.png
```

上传文件`a.png`,使用https模式
```
  qcdn -s a.png
```

上传多个文件`a.png`,`b.jpg`,`c.js`,链接中包含原始文件名
```
  qcdn -k a.png b.png c.js
```

上传文件夹`d`,包含其中隐藏文件且使用https
```
  qcdn -sa d
```

以绝对路径上传多个文件,并以相对路径展示
```
  qcdn -d /User/qcdn/resource /User/qcdn/resource/a.png /User/qcdn/resource/b.png /User/qcdn/resource/c.png
```

上传文本
```
  qcdn -c -t js 'alert("hello world!");'
```

使用管道上传内容
```
  cat a.js | qcdn -t js
```

压缩文件`a.js`
```
  qcdn -m a.js
```

压缩文件`a.js`,`b.css`
```
  qcdn -m a.js b.css
```

使用管道压缩内容
```
  cat a.js | qcdn -m
```

## 使用API

### 上传文件

```js
  import * as qcdn from '@q/qcdn';

  qcdn.upload(filePath);
  qcdn.upload(filePath, opts);
``` 

或

```js
  import qcdn from '@q/qcdn';

  qcdn(filePath);
  qcdn(filePath, opts);
``` 

参数说明:

- filePath 文件路径
- opts 可选参数
    - https 是否使用https,默认*false*
    - force 是否忽略错误,默认*false*
    - keepName 是否保留文件名,默认*false*
    - all 是否忽略隐藏文件,默认*false*
    - directory 返回结果中的相对路径参照值
  
返回值:

返回值是一个标准Promise对象,其中数据格式如下:
```
{
    文件路径1: 静床/图床url1,
    文件路径2: 静床/图床url2,
    文件路径3: 静床/图床url3,
    文件路径4: 静床/图床url4
}
```

### 上传内容

```js
  import * as qcdn from '@q/qcdn';
  
  qcdn.content(content, type, opts);
```

参数说明:

- content 文件内容
- type 文件类型(文件扩展名)
- opts 可选参数
    - https 是否使用https,默认*false*
    
返回值:

文件URL
  
### 压缩文件

*支持压缩js和css文件*

```js
  import * from qcdn from '@q/qcdn';
  
  qcdn.min(code, type);
```

参数说明:

- content 文件内容
- type 文件类型(文件扩展名),留空为自动判断

返回值:

压缩后的文件内容

示例:
```
  // 自动判断文件类型
  qcdn.min(code);
  
  // 压缩js文件
  qcdn.min(jsCode, 'js') 
  
  // 压缩css文件
  qcdn.min(cssCode, 'css');
```

### 错误代码

- **0x1** 文件不存在或不可读
- **0x2** 文件名或文件路径非法
- **0x3** 不支持该文件类型
- **0x4** 不支持该模式
- **0x101** 引用的资源文件缺失
- **0x102** 文件大小超出限制
- **0x103** 文件为空
- **0x104** 压缩后文件为空
- **0x111** 静床网络错误
- **0x121** 静床返回错误
- **0x211** 图床网络错误
- **0x221** 图床返回错误
- **0x301** cassandra配置错误
- **0x321** cassandra系统错误
- **0x322** cassandra响应解析错误
- **0x401** JavaScript语法错误
