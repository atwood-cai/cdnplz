'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.auto = exports.css = exports.js = undefined;

exports.default = function (code) {
    var type = arguments.length <= 1 || arguments[1] === undefined ? 'auto' : arguments[1];
    var ext = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

    switch (type) {
        case 'js':
            return js(code, ext);

        case 'css':
            return css(code, ext);

        case 'auto':
        default:
            return auto(code, ext);
    }
};

var _uglifyJs = require('uglify-js');

var _uglifyJs2 = _interopRequireDefault(_uglifyJs);

var _cleanCss = require('clean-css');

var _cleanCss2 = _interopRequireDefault(_cleanCss);

var _QcdnError = require('./QcdnError');

var _QcdnError2 = _interopRequireDefault(_QcdnError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 压缩js文件
 *
 * @param code {string}
 * @param [ext] {string}
 */
function js(code) {
    var ext = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

    try {
        var result = _uglifyJs2.default.minify(code, { fromString: true });
        return result.code;
    } catch (e) {
        var message = 'JavaScript文件语法错误: ${message}';
        ext.fp && (message += ', ${ext.fp}');
        throw new _QcdnError2.default(0x103, message, {
            fp: ext.fp,
            message: e.message
        });
    }
}

/**
 * 压缩css文件
 *
 * @param code {string}
 * @param [ext] {object}
 */
/**
 * @fileOverview 压缩工具
 * @author 孟之杰(mengzhijie@360.cn)
 * @version 3.0.0
 */

function css(code, ext) {
    var result = new _cleanCss2.default().minify(code);
    return result.styles;
}

/**
 * 自动判断文件类型并压缩文件
 *
 * @param code {string}
 * @param [ext] {object}
 */
function auto(code) {
    var ext = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

    try {
        return js(code, ext);
    } catch (e) {
        return css(code, ext);
    }
}

exports.js = js;
exports.css = css;
exports.auto = auto;

/**
 *
 * @param code
 * @param type
 * @param ext
 */